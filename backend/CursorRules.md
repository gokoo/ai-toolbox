# 后端开发规范

## 代码风格

1. **命名规范**
   - 类使用PascalCase命名（如`UserService`）
   - 函数和变量使用camelCase命名（如`getUserById`）
   - 常量使用UPPER_SNAKE_CASE命名（如`DEFAULT_TIMEOUT`）
   - 文件名使用kebab-case命名（如`user-service.js`）

2. **代码格式化**
   - 使用ESLint和Prettier进行代码格式化
   - 缩进使用2个空格
   - 行尾使用分号
   - 字符串使用单引号

3. **注释规范**
   - 函数和类顶部添加JSDoc风格的注释
   - API端点添加详细的注释，包括参数和返回值
   - 复杂逻辑添加详细注释

## 开发流程

1. **分支管理**
   - 主分支：`main`
   - 开发分支：`dev`
   - 功能分支：`feature/功能名称`
   - 修复分支：`fix/问题描述`

2. **提交规范**
   - feat: 新功能
   - fix: 修复bug
   - docs: 文档更新
   - style: 代码风格调整
   - refactor: 代码重构
   - perf: 性能优化
   - test: 测试相关
   - chore: 构建过程或辅助工具的变动

3. **代码审查**
   - 每个PR至少需要一个审查者
   - 确保代码通过所有自动化测试
   - 遵循项目的代码风格指南

## API设计规范

1. **RESTful API设计**
   - 使用适当的HTTP方法（GET, POST, PUT, DELETE）
   - 使用复数名词表示资源集合（如`/users`而非`/user`）
   - 使用嵌套资源表示关系（如`/users/:id/posts`）
   - 使用查询参数进行过滤、排序和分页

2. **响应格式**
   ```json
   {
     "success": true,
     "data": {},
     "message": "操作成功",
     "code": 200
   }
   ```

3. **错误处理**
   ```json
   {
     "success": false,
     "error": {
       "code": 400,
       "message": "参数错误",
       "details": {}
     }
   }
   ```

4. **版本控制**
   - 在URL中使用版本号（如`/api/v1/users`）
   - 主要版本号变更表示不兼容的API更改

## 数据库规范

1. **MongoDB命名规范**
   - 集合名使用复数形式（如`users`而非`user`）
   - 字段名使用camelCase命名
   - 索引名使用`字段名_索引类型`格式

2. **模型设计**
   - 使用Mongoose Schema定义数据模型
   - 添加适当的验证规则
   - 设置默认值和必填字段

3. **查询优化**
   - 创建必要的索引
   - 使用投影限制返回字段
   - 避免深层嵌套查询

## 安全规范

1. **认证与授权**
   - 使用JWT进行用户认证
   - 实现基于角色的访问控制
   - 敏感操作需要二次验证

2. **数据安全**
   - 敏感数据加密存储
   - API请求和响应数据验证
   - 防止SQL注入和NoSQL注入

3. **API安全**
   - 实现请求限流
   - 设置CORS策略
   - 使用HTTPS
   - 防止CSRF攻击

## 测试规范

1. **单元测试**
   - 使用Jest进行单元测试
   - 测试覆盖率不低于80%
   - 模拟外部依赖

2. **集成测试**
   - 测试API端点
   - 使用测试数据库
   - 测试各种边界条件

3. **性能测试**
   - 使用适当的工具进行负载测试
   - 监控响应时间和资源使用
   - 设置性能基准 